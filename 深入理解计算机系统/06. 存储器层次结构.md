# 第六章 存储器层次结构-未整理

CPU 存储系统是一个具有不同容量、成本和访问时间的存储设备的层次结构：

- CPU寄存器，0个周期内可以访问
- 高速缓存存储器，4～75个周期
- 主存：上百个周期
- 磁盘：几千万个周期

局部性(locality)：具有良好局部性的程序倾向于一次又一次地访问相同的数据项集合，或者是倾向于访问邻近的数据项集合。

本章主要内容：

- 基本存储技术：SRAM存储器、DRAM存储器、ROM存储器以及旋转硬盘和固态硬盘
- 高速缓存存储器
- C程序的局部性
- 存储器山

## 6.1 存储技术

### 6.1.1 随机访问存储器

分类：

- SRAM：静态RAM，用作高速缓存存储器，可以在 CPU 片内，也可以在片外。一般不会超过几兆。
- DRAM：动态 RAM，作为主存以及图形系统的帧缓冲区。几百兆或几千兆字节。

#### 1. 静态RAM

SRAM 的存储单元是利用一个六晶体管电路实现。其具有**双稳态特性**：当摆钟位于最左边或最右边时，是稳定的，如果有干扰来扰乱电压，当干扰消除时，电路就会恢复到稳定值。

#### 2. 动态RAM

DRAM 将每个位存储为对一个电容（30毫微法拉）的充电，每个存储单元由一个电容和一个访问晶体管组成。对干扰非常敏感，电容电压改变后不会再恢复了。

存在漏电情况使得 DRAM 单元在 10～100ms 时间内失去电荷。相对于计算机 ns 级别的运行周期较长，因此需要周期性的读出数据，然后重新刷新内存的每一位。

#### 3. SRAM vs DRAM

|   | 每位晶体管数  | 相对访问时间  | 是否需要刷新（持续？）  | 是否敏感  | 成本  | 应用  |
|---|---|---|---|---|---|---|
| SRAM  | 6  | 1x  | no  | maybe  | 1000x  | 高速缓存存储器  |
| DRAM  | 1  | 10x  | yes  | yes  | 1x  | 主存，帧缓存区 |

#### 4. 传统的DRAM

传统 DRAM 结构：

- 单元（位）被分成 d 个超单元（supercell），每个超单元都由 w 个 DRAM 单元组成。一个 d * w 的DRAM 共有 dw 位信息。
- 超单元被组织成一个 r 行 c 列的长方形矩阵。 r  * c = d
- 每个超单元的地址为 (i,j)，这里 i 表示为行，j 表示为列
- 信息通过引脚流入或者流出芯片
  - data 引脚，传送一个字节的数据
  - addr 引脚，携带2位的行和列的超单元

超单元的控制——内存控制器（memory controller）

- 每一次可以将w位传送到DRAM芯片，或者从 DRAM 芯片中读出
- 读取超单元（i，j）中的内容
  - 内存控制器将行地址i发送到DRAM，行地址i 称为 RAS（Row Access Strobe，行访问选通脉冲），
  - DRAM 响应请求，将 i 行的内容全部复制到一个内部行缓冲区
  - 内存控制器将列地址 j 称为 CAS (Column Access Strobe，列访问选通脉冲)请求发送到 DRAM
  - DRAM 从行缓冲区复制出超单元(i,j)的内容，发送到内存控制器
  - 注意：RAS 和 CAS 共享相同的DRAM地址引脚

### 6.1.2 磁盘

磁盘存储数据的数量级：几百～几千千兆字节，读取信息时间为ms级别
基于RAM的存储器存储数据：几百～几千兆字节，读取时间DRAM比磁盘快10w倍，SRAM比磁盘快100w倍。

#### 1. 磁盘构造

- 盘片
  - 磁道
  - 扇区
  - 间隔
- 柱面

#### 2. 磁盘容量

- 记录密度
- 磁道密度
- 面密度

#### 3. 磁盘操作

- 寻道时间
- 旋转时间
- 传送时间

#### 4. 逻辑磁盘块

- 磁盘控制器
- 逻辑块号 翻译为 盘面 磁道 扇区

***


## 6.2 局部性

***

## 6.3 存储器层次结构

***

## 6.4 高速缓存存储器

***

## 6.5 编写高速缓存友好的代码

***

## 6.6 综合：高速缓存对程序性能的影响

***

## 6.7 小结

***
